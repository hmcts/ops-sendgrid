parameters:
  env: ''
steps:
- task: PowerShell@2
  displayName: 'Deploy NonProd Configuration'
  inputs:
    targetType: inline
    script: |
      $env = 'non-prod'
      cd config/$env
      $config=ls *.json
      Foreach ($i in $config)
      {
        echo 'loop'
        New-AzResourceGroup -Name $i-$env -Location UKSouth
        New-AzResourceGroupDeployment -ResourceGroupName $i-$env `-TemplateFile arm/template.json 
      }
  condition: eq('${{ parameters.env }}', 'nonprod')
- task: PowerShell@2
  displayName: 'Deploy Prod Configuration'
  inputs:
    targetType: inline
    arguments: # Optional
    script: |
      echo 'prod'
      echo $(prod-config)
      New-AzResourceGroup -Name $resourceGroupName -Location $location
      New-AzResourceGroupDeployment -ResourceGroupName $resourceGroupName `-TemplateFile arm/template.json  
  condition: eq('${{ parameters.env }}', 'prod')
