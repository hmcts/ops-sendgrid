parameters:
  env: ''
steps:
- task: PowerShell@2
  displayName: 'Deploy NonProd Configuration'
  inputs:
    targetType: inline
    script: |
      $env = 'non-prod'
      $configFiles = Get-ChildItem -Path config\$env\*.json -Recurse
      Foreach ($file in $policyFiles)
      {
        $parentFolder = Split-Path (Split-Path "$file.FullName" -Parent) -Leaf
        try {
            Write-Host '$env SendGrid for '$file.FullName
            New-AzResourceGroup -Name $i-$env -Location UKSouth
            New-AzResourceGroupDeployment -ResourceGroupName $i-$env `-TemplateFile arm/template.json 
            Write-Host 'Success' -ForegroundColor Green
        } catch {
            Write-Host 'Error: '$Error[0] -ForegroundColor Red
        }

      }
  condition: eq('${{ parameters.env }}', 'nonprod')
- task: PowerShell@2
  displayName: 'Deploy Prod Configuration'
  inputs:
    targetType: inline
    arguments: # Optional
    script: |
      echo 'prod'
      echo $(prod-config)
      New-AzResourceGroup -Name $resourceGroupName -Location $location
      New-AzResourceGroupDeployment -ResourceGroupName $resourceGroupName `-TemplateFile arm/template.json  
  condition: eq('${{ parameters.env }}', 'prod')
